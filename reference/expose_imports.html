<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Expose all the imports in a package so <code>make()</code> can detect
all the package's nested functions. — expose_imports • drake</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Expose all the imports in a package so <code>make()</code> can detect
all the package's nested functions. — expose_imports" />

<meta property="og:description" content="When drake analyzes the functions in your environment,
it understands that some of your functions
are nested inside other functions.
It dives into nested function after nested function in your environment
so that if an inner function changes, targets produced by the outer
functions will become out of date. However, drake stops searching
as soon as it sees a function from a package. This keeps projects
from being too brittle, but it is sometimes problematic.
You may want to strongly depend on a package's internals.
In fact, you may want to wrap your data analysis project itself
in a formal R package,
so you want all your functions to be reproducibly tracked.
To make all a package's functions available to be tracked
as dependencies, use the expose_imports() function.
See the examples in this help file for a demonstration." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">drake</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">6.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/drake.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://ropenscilabs.github.io/drake-manual/faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/drake">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Expose all the imports in a package so <code>make()</code> can detect
all the package's nested functions.</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/drake/blob/master/R/expose_imports.R'><code>R/expose_imports.R</code></a></small>
    <div class="hidden name"><code>expose_imports.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>When <code>drake</code> analyzes the functions in your environment,
it understands that some of your functions
are nested inside other functions.
It dives into nested function after nested function in your environment
so that if an inner function changes, targets produced by the outer
functions will become out of date. However, <code>drake</code> stops searching
as soon as it sees a function from a package. This keeps projects
from being too brittle, but it is sometimes problematic.
You may want to strongly depend on a package's internals.
In fact, you may want to wrap your data analysis project itself
in a formal R package,
so you want all your functions to be reproducibly tracked.</p>
<p>To make all a package's functions available to be tracked
as dependencies, use the <code>expose_imports()</code> function.
See the examples in this help file for a demonstration.</p>
    
    </div>

    <pre class="usage"><span class='fu'>expose_imports</span>(<span class='no'>package</span>, <span class='kw'>character_only</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>envir</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/sys.parent'>parent.frame</a></span>(),
  <span class='kw'>jobs</span> <span class='kw'>=</span> <span class='fl'>1</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>package</th>
      <td><p>name of the package, either a symbol or a string,
depending on <code>character_only</code>.</p></td>
    </tr>
    <tr>
      <th>character_only</th>
      <td><p>logical, whether to interpret <code>package</code>
as a character string or a symbol (quoted vs unquoted).</p></td>
    </tr>
    <tr>
      <th>envir</th>
      <td><p>environment to load the exposed package imports.
You will later pass this <code>envir</code> to <code><a href='make.html'>make()</a></code>.</p></td>
    </tr>
    <tr>
      <th>jobs</th>
      <td><p>number of parallel jobs for the parallel processing
of the imports.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The environment that the exposed imports are loaded into.
Defaults to your R workspace.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Thanks to <a href='https://github.com/dapperjapper'>Jasper Clarkberg</a>
for the idea that makes this function work.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'><a href='test_with_dir.html'>test_with_dir</a></span>(<span class='st'>"contain this example's side effects"</span>, {
<span class='co'># Suppose you have a workflow that uses the `digest()` function,</span>
<span class='co'># which computes the hash of an object.</span>

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>digest</span>) <span class='co'># Has the digest() function.</span>
<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='fu'><a href='https://www.rdocumentation.org/packages/digest/topics/digest'>digest</a></span>(<span class='no'>x</span>)
}
<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='fu'>g</span>(<span class='no'>x</span>)
}
<span class='no'>plan</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='drake_plan.html'>drake_plan</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='fu'>f</span>(<span class='fl'>1</span>))

<span class='co'># Here are the reproducibly tracked objects in the workflow.</span>
<span class='no'>config</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='drake_config.html'>drake_config</a></span>(<span class='no'>plan</span>)
<span class='fu'><a href='tracked.html'>tracked</a></span>(<span class='no'>config</span>)

<span class='co'># But the digest() function has dependencies too.</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='fu'><a href='deps_code.html'>deps_code</a></span>(<span class='no'>digest</span>))

<span class='co'># Why doesn't `drake` import them? Because it knows `digest()`</span>
<span class='co'># is from a package, and it doesn't usually dive into functions</span>
<span class='co'># from packages. We need to call expose_imports() to expose</span>
<span class='co'># a package's inner functions.</span>

<span class='fu'>expose_imports</span>(<span class='no'>digest</span>)
<span class='no'>config</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='drake_config.html'>drake_config</a></span>(<span class='no'>plan</span>)
<span class='no'>new_objects</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='tracked.html'>tracked</a></span>(<span class='no'>config</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='no'>new_objects</span>, <span class='fl'>10</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>new_objects</span>)

<span class='co'># Now when you call `make()`, `drake` will dive into `digest`</span>
<span class='co'># to import dependencies.</span>

<span class='no'>cache</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>storr</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/storr/topics/storr_environment'>storr_environment</a></span>() <span class='co'># just for examples</span>
<span class='fu'><a href='make.html'>make</a></span>(<span class='no'>plan</span>, <span class='kw'>cache</span> <span class='kw'>=</span> <span class='no'>cache</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='fu'><a href='cached.html'>cached</a></span>(<span class='kw'>cache</span> <span class='kw'>=</span> <span class='no'>cache</span>), <span class='fl'>10</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='fu'><a href='cached.html'>cached</a></span>(<span class='kw'>cache</span> <span class='kw'>=</span> <span class='no'>cache</span>))

<span class='co'># Why would you want to expose a whole package like this?</span>
<span class='co'># Because you may want to wrap up your data science project</span>
<span class='co'># as a formal R package. In that case, `expose_imports()`</span>
<span class='co'># tells `drake` to reproducibly track all of your code,</span>
<span class='co'># not just the exported API functions you mention in</span>
<span class='co'># workflow plan commands.</span>

<span class='co'># Note: if you use `digest::digest()`` instead of just `digest()`,</span>
<span class='co'># `drake` does not dive into the function body anymore.</span>
<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='kw pkg'>digest</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/digest/topics/digest'>digest</a></span>(<span class='no'>x</span>) <span class='co'># Was previously just digest()</span>
}
<span class='no'>config</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='drake_config.html'>drake_config</a></span>(<span class='no'>plan</span>)
<span class='fu'><a href='tracked.html'>tracked</a></span>(<span class='no'>config</span>)
})
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

